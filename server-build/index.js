var Ee=Object.defineProperty;var Ft=t=>{throw TypeError(t)};var xe=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>xe(t,typeof e!="symbol"?e+"":e,r),Ct=(t,e,r)=>e.has(t)||Ft("Cannot "+r);var n=(t,e,r)=>(Ct(t,e,"read from private field"),r?r.call(t):e.get(t)),p=(t,e,r)=>e.has(t)?Ft("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),f=(t,e,r,s)=>(Ct(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),g=(t,e,r)=>(Ct(t,e,"access private method"),r);var Mt=(t,e,r,s)=>({set _(i){f(t,e,i,r)},get _(){return n(t,e,s)}});var Tt=(t,e,r)=>(s,i)=>{let o=-1;return a(0);async function a(l){if(l<=o)throw new Error("next() called multiple times");o=l;let c,h=!1,u;if(t[l]?(u=t[l][0][0],s.req.routeIndex=l):u=l===t.length&&i||void 0,u)try{c=await u(s,()=>a(l+1))}catch(w){if(w instanceof Error&&e)s.error=w,c=await e(w,s),h=!0;else throw w}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||h)&&(s.res=c),s}},Oe=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,o=(t instanceof ie?t.raw.headers:t.headers).get("Content-Type");return o!=null&&o.startsWith("multipart/form-data")||o!=null&&o.startsWith("application/x-www-form-urlencoded")?be(t,{all:r,dot:s}):{}};async function be(t,e){const r=await t.formData();return r?me(r,e):{}}function me(t,e){const r=Object.create(null);return t.forEach((s,i)=>{e.all||i.endsWith("[]")?je(r,i,s):r[i]=s}),e.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(Pe(r,s,i),delete r[s])}),r}var je=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r},Pe=(t,e,r)=>{let s=t;const i=e.split(".");i.forEach((o,a)=>{a===i.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})},Zt=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},Ae=t=>{const{groups:e,path:r}=Se(t),s=Zt(r);return $e(s,e)},Se=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const i=`@${s}`;return e.push([i,r]),i}),{groups:e,path:t}},$e=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let i=t.length-1;i>=0;i--)if(t[i].includes(s)){t[i]=t[i].replace(s,e[r][1]);break}}return t},bt={},kt=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return bt[s]||(r[2]?bt[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:bt[s]=[t,r[1],!0]),bt[s]}return null},te=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},He=t=>te(t,decodeURI),ee=t=>{const e=t.url,r=e.indexOf("/",8);let s=r;for(;s<e.length;s++){const i=e.charCodeAt(s);if(i===37){const o=e.indexOf("?",s),a=e.slice(r,o===-1?void 0:o);return He(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(i===63)break}return e.slice(r,s)},Ce=t=>{const e=ee(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},it=(t,e,...r)=>(r.length&&(e=it(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),re=t=>{if(!t.match(/\:.+\?$/))return null;const e=t.split("/"),r=[];let s="";return e.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);const o=i.replace("?","");s+="/"+o,r.push(s)}else s+="/"+i}),r.filter((i,o,a)=>a.indexOf(i)===o)},Dt=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?ne(t):t):t,se=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf(`?${e}`,8);for(a===-1&&(a=t.indexOf(`&${e}`,8));a!==-1;){const l=t.charCodeAt(a+e.length+1);if(l===61){const c=a+e.length+2,h=t.indexOf("&",c);return Dt(t.slice(c,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";a=t.indexOf(`&${e}`,a+1)}if(s=/[%+]/.test(t),!s)return}const i={};s??(s=/[%+]/.test(t));let o=t.indexOf("?",8);for(;o!==-1;){const a=t.indexOf("&",o+1);let l=t.indexOf("=",o);l>a&&a!==-1&&(l=-1);let c=t.slice(o+1,l===-1?a===-1?void 0:a:l);if(s&&(c=Dt(c)),o=a,c==="")continue;let h;l===-1?h="":(h=t.slice(l+1,a===-1?void 0:a),s&&(h=Dt(h))),r?(i[c]&&Array.isArray(i[c])||(i[c]=[]),i[c].push(h)):i[c]??(i[c]=h)}return e?i[e]:i},De=se,Le=(t,e)=>se(t,e,!0),ne=decodeURIComponent,Ut=t=>te(t,ne),ot,C,B,oe,ce,_t,q,Wt,ie=(Wt=class{constructor(t,e="/",r=[[]]){p(this,B);d(this,"raw");p(this,ot);p(this,C);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,q,t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const i=Object.keys(e)[0];return i?e[i].then(o=>(i==="json"&&(o=JSON.stringify(o)),new Response(o)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,f(this,C,r),f(this,ot,{})}param(t){return t?g(this,B,oe).call(this,t):g(this,B,ce).call(this)}query(t){return De(this.url,t)}queries(t){return Le(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await Oe(this,t))}json(){return n(this,q).call(this,"json")}text(){return n(this,q).call(this,"text")}arrayBuffer(){return n(this,q).call(this,"arrayBuffer")}blob(){return n(this,q).call(this,"blob")}formData(){return n(this,q).call(this,"formData")}addValidatedData(t,e){n(this,ot)[t]=e}valid(t){return n(this,ot)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return n(this,C)[0].map(([[,t]])=>t)}get routePath(){return n(this,C)[0].map(([[,t]])=>t)[this.routeIndex].path}},ot=new WeakMap,C=new WeakMap,B=new WeakSet,oe=function(t){const e=n(this,C)[0][this.routeIndex][1][t],r=g(this,B,_t).call(this,e);return r?/\%/.test(r)?Ut(r):r:void 0},ce=function(){const t={},e=Object.keys(n(this,C)[0][this.routeIndex][1]);for(const r of e){const s=g(this,B,_t).call(this,n(this,C)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(t[r]=/\%/.test(s)?Ut(s):s)}return t},_t=function(t){return n(this,C)[1]?n(this,C)[1][t]:t},q=new WeakMap,Wt),_e={Stringify:1},ae=async(t,e,r,s,i)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const o=t.callbacks;return o!=null&&o.length?(i?i[0]+=t:i=[t],Promise.all(o.map(l=>l({phase:e,buffer:i,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(c=>ae(c,e,!1,s,i))).then(()=>i[0]))):Promise.resolve(t)},Ie="text/plain; charset=UTF-8",Lt=(t,e={})=>{for(const r of Object.keys(e))t.set(r,e[r]);return t},wt,yt,F,Y,M,v,E,I,T,vt,ct,at,Rt,Et,A,H,qt,Ne=(qt=class{constructor(t,e){p(this,A);p(this,wt);p(this,yt);d(this,"env",{});p(this,F);d(this,"finalized",!1);d(this,"error");p(this,Y,200);p(this,M);p(this,v);p(this,E);p(this,I);p(this,T,!0);p(this,vt);p(this,ct);p(this,at);p(this,Rt);p(this,Et);d(this,"render",(...t)=>(n(this,ct)??f(this,ct,e=>this.html(e)),n(this,ct).call(this,...t)));d(this,"setLayout",t=>f(this,vt,t));d(this,"getLayout",()=>n(this,vt));d(this,"setRenderer",t=>{f(this,ct,t)});d(this,"header",(t,e,r)=>{if(e===void 0){n(this,v)?n(this,v).delete(t):n(this,E)&&delete n(this,E)[t.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(t);return}r!=null&&r.append?(n(this,v)||(f(this,T,!1),f(this,v,new Headers(n(this,E))),f(this,E,{})),n(this,v).append(t,e)):n(this,v)?n(this,v).set(t,e):(n(this,E)??f(this,E,{}),n(this,E)[t.toLowerCase()]=e),this.finalized&&(r!=null&&r.append?this.res.headers.append(t,e):this.res.headers.set(t,e))});d(this,"status",t=>{f(this,T,!1),f(this,Y,t)});d(this,"set",(t,e)=>{n(this,F)??f(this,F,new Map),n(this,F).set(t,e)});d(this,"get",t=>n(this,F)?n(this,F).get(t):void 0);d(this,"newResponse",(...t)=>g(this,A,H).call(this,...t));d(this,"body",(t,e,r)=>typeof e=="number"?g(this,A,H).call(this,t,e,r):g(this,A,H).call(this,t,e));d(this,"text",(t,e,r)=>{if(!n(this,E)){if(n(this,T)&&!r&&!e)return new Response(t);f(this,E,{})}return n(this,E)["content-type"]=Ie,typeof e=="number"?g(this,A,H).call(this,t,e,r):g(this,A,H).call(this,t,e)});d(this,"json",(t,e,r)=>{const s=JSON.stringify(t);return n(this,E)??f(this,E,{}),n(this,E)["content-type"]="application/json",typeof e=="number"?g(this,A,H).call(this,s,e,r):g(this,A,H).call(this,s,e)});d(this,"html",(t,e,r)=>(n(this,E)??f(this,E,{}),n(this,E)["content-type"]="text/html; charset=UTF-8",typeof t=="object"?ae(t,_e.Stringify,!1,{}).then(s=>typeof e=="number"?g(this,A,H).call(this,s,e,r):g(this,A,H).call(this,s,e)):typeof e=="number"?g(this,A,H).call(this,t,e,r):g(this,A,H).call(this,t,e)));d(this,"redirect",(t,e)=>(n(this,v)??f(this,v,new Headers),n(this,v).set("Location",String(t)),this.newResponse(null,e??302)));d(this,"notFound",()=>(n(this,at)??f(this,at,()=>new Response),n(this,at).call(this,this)));f(this,wt,t),e&&(f(this,M,e.executionCtx),this.env=e.env,f(this,at,e.notFoundHandler),f(this,Et,e.path),f(this,Rt,e.matchResult))}get req(){return n(this,yt)??f(this,yt,new ie(n(this,wt),n(this,Et),n(this,Rt))),n(this,yt)}get event(){if(n(this,M)&&"respondWith"in n(this,M))return n(this,M);throw Error("This context has no FetchEvent")}get executionCtx(){if(n(this,M))return n(this,M);throw Error("This context has no ExecutionContext")}get res(){return f(this,T,!1),n(this,I)||f(this,I,new Response("404 Not Found",{status:404}))}set res(t){if(f(this,T,!1),n(this,I)&&t)try{for(const[e,r]of n(this,I).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=n(this,I).headers.getSetCookie();t.headers.delete("set-cookie");for(const i of s)t.headers.append("set-cookie",i)}else t.headers.set(e,r)}catch(e){if(e instanceof TypeError&&e.message.includes("immutable")){this.res=new Response(t.body,{headers:t.headers,status:t.status});return}else throw e}f(this,I,t),this.finalized=!0}get var(){return n(this,F)?Object.fromEntries(n(this,F)):{}}},wt=new WeakMap,yt=new WeakMap,F=new WeakMap,Y=new WeakMap,M=new WeakMap,v=new WeakMap,E=new WeakMap,I=new WeakMap,T=new WeakMap,vt=new WeakMap,ct=new WeakMap,at=new WeakMap,Rt=new WeakMap,Et=new WeakMap,A=new WeakSet,H=function(t,e,r){if(n(this,T)&&!r&&!e&&n(this,Y)===200)return new Response(t,{headers:n(this,E)});if(e&&typeof e!="number"){const i=new Headers(e.headers);n(this,v)&&n(this,v).forEach((a,l)=>{l==="set-cookie"?i.append(l,a):i.set(l,a)});const o=Lt(i,n(this,E));return new Response(t,{headers:o,status:e.status??n(this,Y)})}const s=typeof e=="number"?e:n(this,Y);n(this,E)??f(this,E,{}),n(this,v)??f(this,v,new Headers),Lt(n(this,v),n(this,E)),n(this,I)&&(n(this,I).headers.forEach((i,o)=>{var a,l;o==="set-cookie"?(a=n(this,v))==null||a.append(o,i):(l=n(this,v))==null||l.set(o,i)}),Lt(n(this,v),n(this,E))),r??(r={});for(const[i,o]of Object.entries(r))if(typeof o=="string")n(this,v).set(i,o);else{n(this,v).delete(i);for(const a of o)n(this,v).append(i,a)}return new Response(t,{status:s,headers:n(this,v)})},qt),x="ALL",Fe="all",Me=["get","post","put","delete","options","patch"],he="Can not add a route since the matcher is already built.",le=class extends Error{},Te="__COMPOSED_HANDLER",ke=t=>t.text("404 Not Found",404),Kt=(t,e)=>"getResponse"in t?t.getResponse():(console.error(t),e.text("Internal Server Error",500)),D,O,fe,k,J,mt,jt,zt,ue=(zt=class{constructor(e={}){p(this,O);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,D,"/");d(this,"routes",[]);p(this,k,ke);d(this,"errorHandler",Kt);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,k,e),this));d(this,"fetch",(e,...r)=>g(this,O,jt).call(this,e,r[1],r[0],e.method));d(this,"request",(e,r,s,i)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,i):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${it("/",e)}`,r),s,i)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(g(this,O,jt).call(this,e.request,e,void 0,e.request.method))})});[...Me,Fe].forEach(i=>{this[i]=(o,...a)=>(typeof o=="string"?f(this,D,o):g(this,O,J).call(this,i,n(this,D),o),a.forEach(l=>{g(this,O,J).call(this,i,n(this,D),l)}),this)}),this.on=(i,o,...a)=>{for(const l of[o].flat()){f(this,D,l);for(const c of[i].flat())a.map(h=>{g(this,O,J).call(this,c.toUpperCase(),n(this,D),h)})}return this},this.use=(i,...o)=>(typeof i=="string"?f(this,D,i):(f(this,D,"*"),o.unshift(i)),o.forEach(a=>{g(this,O,J).call(this,x,n(this,D),a)}),this);const s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??ee:Ce}route(e,r){const s=this.basePath(e);return r.routes.map(i=>{var a;let o;r.errorHandler===Kt?o=i.handler:(o=async(l,c)=>(await Tt([],r.errorHandler)(l,()=>i.handler(l,c))).res,o[Te]=i.handler),g(a=s,O,J).call(a,i.method,i.path,o)}),this}basePath(e){const r=g(this,O,fe).call(this);return r._basePath=it(this._basePath,e),r}mount(e,r,s){let i,o;s&&(typeof s=="function"?o=s:(o=s.optionHandler,i=s.replaceRequest));const a=o?c=>{const h=o(c);return Array.isArray(h)?h:[h]}:c=>{let h;try{h=c.executionCtx}catch{}return[c.env,h]};i||(i=(()=>{const c=it(this._basePath,e),h=c==="/"?0:c.length;return u=>{const w=new URL(u.url);return w.pathname=w.pathname.slice(h)||"/",new Request(w,u)}})());const l=async(c,h)=>{const u=await r(i(c.req.raw),...a(c));if(u)return u;await h()};return g(this,O,J).call(this,x,it(e,"*"),l),this}},D=new WeakMap,O=new WeakSet,fe=function(){const e=new ue({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},k=new WeakMap,J=function(e,r,s){e=e.toUpperCase(),r=it(this._basePath,r);const i={path:r,method:e,handler:s};this.router.add(e,r,[s,i]),this.routes.push(i)},mt=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},jt=function(e,r,s,i){if(i==="HEAD")return(async()=>new Response(null,await g(this,O,jt).call(this,e,r,s,"GET")))();const o=this.getPath(e,{env:s}),a=this.router.match(i,o),l=new Ne(e,{path:o,matchResult:a,env:s,executionCtx:r,notFoundHandler:n(this,k)});if(a[0].length===1){let h;try{h=a[0][0][0][0](l,async()=>{l.res=await n(this,k).call(this,l)})}catch(u){return g(this,O,mt).call(this,u,l)}return h instanceof Promise?h.then(u=>u||(l.finalized?l.res:n(this,k).call(this,l))).catch(u=>g(this,O,mt).call(this,u,l)):h??n(this,k).call(this,l)}const c=Tt(a[0],this.errorHandler,n(this,k));return(async()=>{try{const h=await c(l);if(!h.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return h.res}catch(h){return g(this,O,mt).call(this,h,l)}})()},zt),At="[^/]+",pt=".*",gt="(?:|/.*)",dt=Symbol(),Ue=new Set(".\\+*[^]$()");function Ke(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===pt||t===gt?1:e===pt||e===gt?-1:t===At?1:e===At?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var Z,tt,L,Vt,It=(Vt=class{constructor(){p(this,Z);p(this,tt);p(this,L,Object.create(null))}insert(e,r,s,i,o){if(e.length===0){if(n(this,Z)!==void 0)throw dt;if(o)return;f(this,Z,r);return}const[a,...l]=e,c=a==="*"?l.length===0?["","",pt]:["","",At]:a==="/*"?["","",gt]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let h;if(c){const u=c[1];let w=c[2]||At;if(u&&c[2]&&(w=w.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(w)))throw dt;if(h=n(this,L)[w],!h){if(Object.keys(n(this,L)).some(y=>y!==pt&&y!==gt))throw dt;if(o)return;h=n(this,L)[w]=new It,u!==""&&f(h,tt,i.varIndex++)}!o&&u!==""&&s.push([u,n(h,tt)])}else if(h=n(this,L)[a],!h){if(Object.keys(n(this,L)).some(u=>u.length>1&&u!==pt&&u!==gt))throw dt;if(o)return;h=n(this,L)[a]=new It}h.insert(l,r,s,i,o)}buildRegExpStr(){const r=Object.keys(n(this,L)).sort(Ke).map(s=>{const i=n(this,L)[s];return(typeof n(i,tt)=="number"?`(${s})@${n(i,tt)}`:Ue.has(s)?`\\${s}`:s)+i.buildRegExpStr()});return typeof n(this,Z)=="number"&&r.unshift(`#${n(this,Z)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Z=new WeakMap,tt=new WeakMap,L=new WeakMap,Vt),St,xt,Gt,Be=(Gt=class{constructor(){p(this,St,{varIndex:0});p(this,xt,new It)}insert(t,e,r){const s=[],i=[];for(let a=0;;){let l=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{const h=`@\\${a}`;return i[a]=[h,c],a++,l=!0,h}),!l)break}const o=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=i.length-1;a>=0;a--){const[l]=i[a];for(let c=o.length-1;c>=0;c--)if(o[c].indexOf(l)!==-1){o[c]=o[c].replace(l,i[a][1]);break}}return n(this,xt).insert(o,e,s,n(this,St),r),s}buildRegExp(){let t=n(this,xt).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,o,a)=>o!==void 0?(r[++e]=Number(o),"$()"):(a!==void 0&&(s[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,s]}},St=new WeakMap,xt=new WeakMap,Gt),de=[],We=[/^$/,[],Object.create(null)],Pt=Object.create(null);function pe(t){return Pt[t]??(Pt[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function qe(){Pt=Object.create(null)}function ze(t){var h;const e=new Be,r=[];if(t.length===0)return We;const s=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,w],[y,b])=>u?1:y?-1:w.length-b.length),i=Object.create(null);for(let u=0,w=-1,y=s.length;u<y;u++){const[b,S,R]=s[u];b?i[S]=[R.map(([$])=>[$,Object.create(null)]),de]:w++;let P;try{P=e.insert(S,w,b)}catch($){throw $===dt?new le(S):$}b||(r[w]=R.map(([$,st])=>{const ut=Object.create(null);for(st-=1;st>=0;st--){const[_,$t]=P[st];ut[_]=$t}return[$,ut]}))}const[o,a,l]=e.buildRegExp();for(let u=0,w=r.length;u<w;u++)for(let y=0,b=r[u].length;y<b;y++){const S=(h=r[u][y])==null?void 0:h[1];if(!S)continue;const R=Object.keys(S);for(let P=0,$=R.length;P<$;P++)S[R[P]]=l[S[R[P]]]}const c=[];for(const u in a)c[u]=r[a[u]];return[o,c,i]}function nt(t,e){if(t){for(const r of Object.keys(t).sort((s,i)=>i.length-s.length))if(pe(r).test(e))return[...t[r]]}}var z,V,lt,ge,we,Xt,Ve=(Xt=class{constructor(){p(this,lt);d(this,"name","RegExpRouter");p(this,z);p(this,V);f(this,z,{[x]:Object.create(null)}),f(this,V,{[x]:Object.create(null)})}add(t,e,r){var l;const s=n(this,z),i=n(this,V);if(!s||!i)throw new Error(he);s[t]||[s,i].forEach(c=>{c[t]=Object.create(null),Object.keys(c[x]).forEach(h=>{c[t][h]=[...c[x][h]]})}),e==="/*"&&(e="*");const o=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=pe(e);t===x?Object.keys(s).forEach(h=>{var u;(u=s[h])[e]||(u[e]=nt(s[h],e)||nt(s[x],e)||[])}):(l=s[t])[e]||(l[e]=nt(s[t],e)||nt(s[x],e)||[]),Object.keys(s).forEach(h=>{(t===x||t===h)&&Object.keys(s[h]).forEach(u=>{c.test(u)&&s[h][u].push([r,o])})}),Object.keys(i).forEach(h=>{(t===x||t===h)&&Object.keys(i[h]).forEach(u=>c.test(u)&&i[h][u].push([r,o]))});return}const a=re(e)||[e];for(let c=0,h=a.length;c<h;c++){const u=a[c];Object.keys(i).forEach(w=>{var y;(t===x||t===w)&&((y=i[w])[u]||(y[u]=[...nt(s[w],u)||nt(s[x],u)||[]]),i[w][u].push([r,o-h+c+1]))})}}match(t,e){qe();const r=g(this,lt,ge).call(this);return this.match=(s,i)=>{const o=r[s]||r[x],a=o[2][i];if(a)return a;const l=i.match(o[0]);if(!l)return[[],de];const c=l.indexOf("",1);return[o[1][c],l]},this.match(t,e)}},z=new WeakMap,V=new WeakMap,lt=new WeakSet,ge=function(){const t=Object.create(null);return Object.keys(n(this,V)).concat(Object.keys(n(this,z))).forEach(e=>{t[e]||(t[e]=g(this,lt,we).call(this,e))}),f(this,z,f(this,V,void 0)),t},we=function(t){const e=[];let r=t===x;return[n(this,z),n(this,V)].forEach(s=>{const i=s[t]?Object.keys(s[t]).map(o=>[o,s[t][o]]):[];i.length!==0?(r||(r=!0),e.push(...i)):t!==x&&e.push(...Object.keys(s[x]).map(o=>[o,s[x][o]]))}),r?ze(e):null},Xt),G,U,Jt,Ge=(Jt=class{constructor(t){d(this,"name","SmartRouter");p(this,G,[]);p(this,U,[]);f(this,G,t.routers)}add(t,e,r){if(!n(this,U))throw new Error(he);n(this,U).push([t,e,r])}match(t,e){if(!n(this,U))throw new Error("Fatal error");const r=n(this,G),s=n(this,U),i=r.length;let o=0,a;for(;o<i;o++){const l=r[o];try{for(let c=0,h=s.length;c<h;c++)l.add(...s[c]);a=l.match(t,e)}catch(c){if(c instanceof le)continue;throw c}this.match=l.match.bind(l),f(this,G,[l]),f(this,U,void 0);break}if(o===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(n(this,U)||n(this,G).length!==1)throw new Error("No active router has been determined yet.");return n(this,G)[0]}},G=new WeakMap,U=new WeakMap,Jt),ft=Object.create(null),X,j,et,ht,m,K,Q,Qt,ye=(Qt=class{constructor(t,e,r){p(this,K);p(this,X);p(this,j);p(this,et);p(this,ht,0);p(this,m,ft);if(f(this,j,r||Object.create(null)),f(this,X,[]),t&&e){const s=Object.create(null);s[t]={handler:e,possibleKeys:[],score:0},f(this,X,[s])}f(this,et,[])}insert(t,e,r){f(this,ht,++Mt(this,ht)._);let s=this;const i=Ae(e),o=[];for(let c=0,h=i.length;c<h;c++){const u=i[c],w=i[c+1],y=kt(u,w),b=Array.isArray(y)?y[0]:u;if(Object.keys(n(s,j)).includes(b)){s=n(s,j)[b];const S=kt(u,w);S&&o.push(S[1]);continue}n(s,j)[b]=new ye,y&&(n(s,et).push(y),o.push(y[1])),s=n(s,j)[b]}const a=Object.create(null),l={handler:r,possibleKeys:o.filter((c,h,u)=>u.indexOf(c)===h),score:n(this,ht)};return a[t]=l,n(s,X).push(a),s}search(t,e){var l;const r=[];f(this,m,ft);let i=[this];const o=Zt(e),a=[];for(let c=0,h=o.length;c<h;c++){const u=o[c],w=c===h-1,y=[];for(let b=0,S=i.length;b<S;b++){const R=i[b],P=n(R,j)[u];P&&(f(P,m,n(R,m)),w?(n(P,j)["*"]&&r.push(...g(this,K,Q).call(this,n(P,j)["*"],t,n(R,m))),r.push(...g(this,K,Q).call(this,P,t,n(R,m)))):y.push(P));for(let $=0,st=n(R,et).length;$<st;$++){const ut=n(R,et)[$],_=n(R,m)===ft?{}:{...n(R,m)};if(ut==="*"){const W=n(R,j)["*"];W&&(r.push(...g(this,K,Q).call(this,W,t,n(R,m))),f(W,m,_),y.push(W));continue}if(u==="")continue;const[$t,Nt,Ot]=ut,N=n(R,j)[$t],Re=o.slice(c).join("/");if(Ot instanceof RegExp){const W=Ot.exec(Re);if(W){if(_[Nt]=W[0],r.push(...g(this,K,Q).call(this,N,t,n(R,m),_)),Object.keys(n(N,j)).length){f(N,m,_);const Ht=((l=W[0].match(/\//))==null?void 0:l.length)??0;(a[Ht]||(a[Ht]=[])).push(N)}continue}}(Ot===!0||Ot.test(u))&&(_[Nt]=u,w?(r.push(...g(this,K,Q).call(this,N,t,_,n(R,m))),n(N,j)["*"]&&r.push(...g(this,K,Q).call(this,n(N,j)["*"],t,_,n(R,m)))):(f(N,m,_),y.push(N)))}}i=y.concat(a.shift()??[])}return r.length>1&&r.sort((c,h)=>c.score-h.score),[r.map(({handler:c,params:h})=>[c,h])]}},X=new WeakMap,j=new WeakMap,et=new WeakMap,ht=new WeakMap,m=new WeakMap,K=new WeakSet,Q=function(t,e,r,s){const i=[];for(let o=0,a=n(t,X).length;o<a;o++){const l=n(t,X)[o],c=l[e]||l[x],h={};if(c!==void 0&&(c.params=Object.create(null),i.push(c),r!==ft||s&&s!==ft))for(let u=0,w=c.possibleKeys.length;u<w;u++){const y=c.possibleKeys[u],b=h[c.score];c.params[y]=s!=null&&s[y]&&!b?s[y]:r[y]??(s==null?void 0:s[y]),h[c.score]=!0}}return i},Qt),rt,Yt,Xe=(Yt=class{constructor(){d(this,"name","TrieRouter");p(this,rt);f(this,rt,new ye)}add(t,e,r){const s=re(e);if(s){for(let i=0,o=s.length;i<o;i++)n(this,rt).insert(t,s[i],r);return}n(this,rt).insert(t,e,r)}match(t,e){return n(this,rt).search(t,e)}},rt=new WeakMap,Yt),Je=class extends ue{constructor(t={}){super(t),this.router=t.router??new Ge({routers:[new Ve,new Xe]})}};const Bt=new Je,Qe=Object.assign({});let ve=!1;for(const[,t]of Object.entries(Qe))t&&(Bt.route("/",t),Bt.notFound(e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),ve=!0);if(!ve)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Bt as default};
